<link rel="import" href="../../../../../cores/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../../../../cores/bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../../../../cores/bower_components/paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../../../../../cores/elements/kct-checkbox/kct-checkbox.html">
<link rel="import" href="../../../../../cores/elements/kct-layouts/kct-hbox.html">

<dom-module id="skp-report">
    <template>
        <style include="skp-page-style">

            .page,
            .table th,
            .table td {
                font-family: Cambria, 'Segoe UI', Roboto, Arial, sans-serif;
                font-size: 15px;
            }

            

            paper-spinner-lite {
                
            }

            .main, 
            .side {
                height: calc(100vh - 128px);
            }

            .page  {
                padding: 20px;
                box-sizing: border-box;
            }

            .table {
                margin-bottom: 15px;
            }

            .table thead {
                border-top: 2px solid #d0d0d0;
                border-bottom: 2px solid #d0d0d0;
            }

            .table th {
                font-weight: bold;
            }

            .table.report-header td,
            .table.report-subheader td,
            .table.report-footer td {
                padding: 3px 5px;
            }
            .table tr.group-row {
                font-weight: bold;
            }
            .table tr.group-row:first-child {
                border-top: 1px solid #d0d0d0;
            }
            .table tr.header-row td {
                font-weight: bold;
            }
            .table th.text-middle,
            .table td.text-middle {
                vertical-align: middle !important;
            }
            .table.bordered.complex th + th,
            .table.bordered.complex td + td {
                border-left: 1px solid #d0d0d0;
            }
            .tabs {
                box-sizing: border-box;
                background-color: #fff;
                border-top: 2px solid var(--tabs-border-color, var(--paper-blue-grey-500));
            }

            paper-tabs {
                height: 32px;
                font-weight: normal;
                --paper-tabs-scroller-opacity: 0.3;
                --paper-tabs-selection-bar-color: var(--paper-blue-grey-500);
            }

            paper-tab {
                min-width: 70px;
                position: relative;
                --paper-tab-ink: var(--paper-blue-grey-500);
            }

            paper-tab.iron-selected {
                color: #fff;
            }

            paper-tab .overlay {
                display: none;
                position: absolute;
                top: 0;
                left: -12px;
                right: -12px;
                bottom: 0;
            }

            paper-tab .caption {
                position: relative;
                z-index: 2;
                font-size: 12px;
                font-weight: bold;
            }

            paper-tab.iron-selected .overlay {
                display: block;
            }

            iron-pages[hidden] {
                display: none;
            }

            .logo-garuda {
                width: 130px;
                height: 130px;
                background-image: url(../../../../images/misc/garuda.jpg);
                background-repeat: no-repeat;
                display: inline-block;
            }
            .table-cover td.cover-header {
                padding: 0;
                font-size: 18px;
                font-weight: bold;
            }
            .table-cover td.cover-subheader {
                font-size: 16px;
                font-weight: bold;
                padding: 0;
            }
            .table-cover td.cover-spacer {
                height: 50px;
            }
            .table.noborder td {
                border: none !important;
                padding: 5px 0;
            }
        </style>

        <kct-ajax id="ajax"></kct-ajax>

        <kct-vbox class="container">
            <setting-header-block 
                icon="today" 
                text="Laporan"
                desc="Penilaian SKP" 
                on-back-tap="__onBackTap">
                <paper-icon-button slot="right-toolbar" icon="refresh" on-tap="__onReloadTap"></paper-icon-button>
                <paper-icon-button slot="right-toolbar" icon="print" on-tap="__onPrintTap"></paper-icon-button>
                <paper-icon-button slot="right-toolbar" icon="search" on-tap="__onOpenDrawerTap"></paper-icon-button>
            </setting-header-block>

            <div class="flex">
                <app-drawer-layout id="drawer-layout" force-narrow>
                    <app-drawer id="drawer" slot="drawer" align="end">
                        <app-toolbar>
                            <paper-icon-button icon="close" on-tap="__onCloseDrawerTap"></paper-icon-button>
                        </app-toolbar>
                        <div class="side">
                            <h3>Parameter</h3>
                            <div>
                                <combo-user 
                                    id="combo-user" 
                                    url="/skp/observable-users"
                                    label="Pegawai" 
                                    value="{{ params.user }}" 
                                    on-change="__onComboUserChange"></combo-user>

                                <kct-combobox 
                                    id="combo-skp" 
                                    label="Dokumen SKP" 
                                    value="{{ params.skp }}" 
                                    url="/skp" 
                                    item-label-path="skp_period" 
                                    item-value-path="skp_id" 
                                    on-beforeload="__onComboSkpBeforeload"></kct-combobox>
                            </div>
                            <div class="m-t">
                                <paper-button disabled$="[[ loading ]]" on-tap="__onQueryTap" class="btn-primary">Query Data</paper-button>
                            </div>
                        </div>
                    </app-drawer>
                    <div class="main">
                        
                        <kct-vbox>
                            <div class="flex scroll-y">

                                <div class="text-center m-t" hidden$="[[ !loading ]]">
                                    <paper-spinner-lite active></paper-spinner-lite>    
                                </div>

                                <iron-pages selected="[[ sheetIndex ]]" hidden$="[[ loading ]]">
                                    <div class="page">
                                        <table class="table report-header">
                                            <tbody>
                                                <tr>
                                                    <td class="text-center"><h3>DATA SASARAN KERJA PEGAWAI</h3></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <table class="table bordered">
                                            <tbody>
                                                <template is="dom-repeat" items="[[ actors ]]" as="actor">
                                                    <tr class="group-row">
                                                        <td style="width: 20px;">[[ __computeSequence(index) ]].</td>
                                                        <td colspan="4">[[ actor.label ]]</td>
                                                    </tr>
                                                    <template is="dom-repeat" items="[[ actor.props ]]">
                                                        <tr>
                                                            <td>&nbsp;</td>
                                                            <td style="width: 20px;">[[ __computeSequence(index, 'letter') ]].</td>
                                                            <td style="width: 150px;">[[ item.label ]]</td>
                                                            <td style="width: 10px;">:</td>
                                                            <td style$="[[ item.style ]]">[[ item.value ]]</td>
                                                        </tr>
                                                    </template>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="page">
                                        <table class="table table-cover">
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">
                                                        <div class="logo-garuda"></div>
                                                    </td>
                                                </tr>
                                                <tr><td class="text-center cover-header">[[ report.skp_cover_header_1 ]]</td></tr>
                                                <tr><td class="text-center cover-header">[[ report.skp_cover_header_2 ]]</td></tr>
                                                <tr><td class="text-center cover-spacer"></td></tr>
                                                <tr><td class="text-center cover-subheader">Jangka Waktu Penilaian</td></tr>
                                                <tr><td class="text-center cover-subheader">[[ report.skp_period ]]</td></tr>
                                                <tr><td class="text-center cover-spacer"></td></tr>
                                                <tr>
                                                    <td>
                                                        <table class="table" style="width: 600px; margin: auto;">
                                                            <tbody>
                                                                <template is="dom-repeat" items="[[ actors.0.props ]]">
                                                                    <tr>
                                                                        <td style="width: 200px; padding-left: 100px;">[[ item.label ]] Pegawai</td>    
                                                                        <td style="width: 10px;">:</td>
                                                                        <td style$="[[ item.style ]]">[[ item.value ]]</td>
                                                                    </tr>
                                                                </template>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                </tr>
                                                <tr><td class="text-center cover-spacer"></td></tr>
                                                <tr><td class="text-center cover-header">[[ report.skp_cover_footer_1 ]]</td></tr>
                                                <tr><td class="text-center cover-header">[[ report.skp_cover_footer_2 ]]</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="page">
                                        <table class="table report-header">
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">
                                                        <h3>
                                                            FORMULIR SASARAN KERJA<br>
                                                            [[ report.skp_cover_header_2 ]]
                                                        </h3>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="p-t p-b"><strong>TAHUN [[ report.skp_year ]]</strong></div>
                                        <table class="table bordered complex">
                                            <thead>
                                                <tr>
                                                    <th style="width: 60px;">NO</th>
                                                    <th colspan="3" class="text-left">I. PEJABAT PENILAI</th>
                                                    <th>NO</th>
                                                    <th colspan="4"  class="text-left">II.  [[ report.skp_cover_header_2 ]] YANG DINILAI</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">1</td>
                                                    <td style="width: 150px;">Nama</td>
                                                    <td colspan="2"><strong>[[ report.evaluator_su_fullname ]]</strong></td>
                                                    <td class="text-center">1</td>
                                                    <td style="width: 150px;">Nama</td>
                                                    <td colspan="3"><strong>[[ report.skp_su_fullname ]]</strong></td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">2</td>
                                                    <td>NIP</td>
                                                    <td colspan="2">[[ report.evaluator_su_no ]]</td>
                                                    <td class="text-center">2</td>
                                                    <td>NIP</td>
                                                    <td colspan="3">[[ report.skp_su_no ]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">3</td>
                                                    <td>Pangkat/Gol.Ruang</td>
                                                    <td colspan="2">[[ report.evaluator_su_sg_name ]]</td>
                                                    <td class="text-center">3</td>
                                                    <td>Pangkat/Gol.Ruang</td>
                                                    <td colspan="3">[[ report.skp_su_sg_name ]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">4</td>
                                                    <td>Jabatan</td>
                                                    <td colspan="2">[[ report.evaluator_su_sj_name ]]</td>
                                                    <td class="text-center">4</td>
                                                    <td>Jabatan</td>
                                                    <td colspan="3">[[ report.skp_su_sj_name ]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">5</td>
                                                    <td>Unit Kerja</td>
                                                    <td colspan="2">[[ report.evaluator_su_sdp_name ]]</td>
                                                    <td class="text-center">5</td>
                                                    <td>Unit Kerja</td>
                                                    <td colspan="3">[[ report.skp_su_sdp_name ]]</td>
                                                </tr>
                                                <tr class="header-row">
                                                    <td class="text-center text-middle" rowspan="2">NO</td>
                                                    <td class="text-center text-middle" rowspan="2" colspan="2">III. KEGIATAN TUGAS JABATAN</td>
                                                    <td class="text-center text-middle" rowspan="2" style="width: 60px;">&nbsp;</td>
                                                    <td class="text-center text-middle" rowspan="2" style="width: 60px;">AK</td>
                                                    <td class="text-center" colspan="4">TARGET</td>
                                                </tr>
                                                <tr class="header-row">
                                                    <td class="text-center">KUANTITAS</td>
                                                    <td class="text-center" style="width: 80px;">MUTU</td>
                                                    <td class="text-center" style="width: 100px;">WAKTU</td>
                                                    <td class="text-center" style="width: 100px;">BIAYA</td>
                                                </tr>
                                                <template is="dom-repeat" items="[[ report.items ]]">
                                                    <tr>
                                                        <td class="text-center">[[ __computeSequence(index) ]]</td>
                                                        <td colspan="2">[[ item.ski_desc ]]</td>
                                                        <td class="text-center">[[ item.ski_ak_factor_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_ak_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_volume_formatted ]] [[ item.ski_unit ]]</td>
                                                        <td class="text-center">[[ item.ski_quality_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_duration_formatted ]] [[ item.ski_duration_unit ]]</td>
                                                        <td class="text-center">[[ item.ski_cost_formatted ]]</td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="page">
                                        <table class="table report-header">
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">
                                                        <h3>
                                                            PENILAIAN CAPAIAN SASARAN KERJA<br>
                                                            [[ report.skp_cover_header_2 ]]
                                                        </h3>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="p-t p-b">
                                            <div>Jangka Waktu Penilaian</div>
                                            <div>[[ report.skp_period ]]</div>
                                        </div>
                                        <table class="table bordered complex">
                                            <thead>
                                                <tr>
                                                    <th class="text-middle" rowspan="2">NO</th>
                                                    <th class="text-middle" rowspan="2">I. KEGIATAN TUGAS UTAMA</th>
                                                    <th class="text-middle" rowspan="2" style="width: 50px;">AK</th>
                                                    <th colspan="4">TARGET</th>
                                                    <th class="text-middle" rowspan="2" style="width: 50px;">AK</th>
                                                    <th colspan="4">REALISASI</th>
                                                    <th class="text-middle" rowspan="2">PENGHI TUNGAN</th>
                                                    <th class="text-middle" rowspan="2">NILAI CAPAIAN</th>
                                                </tr>
                                                <tr>
                                                    <th style="width: 100px;">KUANTITAS</th>
                                                    <th style="width: 50px;">MUTU</th>
                                                    <th style="width: 80px;">WAKTU</th>
                                                    <th style="width: 100px;">BIAYA</th>

                                                    <th style="width: 100px;">KUANTITAS</th>
                                                    <th style="width: 50px;">MUTU</th>
                                                    <th style="width: 80px;">WAKTU</th>
                                                    <th style="width: 100px;">BIAYA</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <template is="dom-repeat" items="[[ report.items ]]">
                                                    <tr>
                                                        <td class="text-center">[[ __computeSequence(index) ]]</td>
                                                        <td>[[ item.ski_desc ]]</td>
                                                        <td class="text-center">[[ item.ski_ak_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_volume_formatted ]] [[ item.ski_unit ]]</td>
                                                        <td class="text-center">[[ item.ski_quality_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_duration_formatted ]] [[ item.ski_duration_unit ]]</td>
                                                        <td class="text-center">[[ item.ski_cost_formatted ]]</td>

                                                        <td class="text-center">[[ item.ski_ak_real_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_volume_real_formatted ]] [[ item.ski_unit ]]</td>
                                                        <td class="text-center">[[ item.ski_quality_real_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_duration_real_formatted ]] [[ item.ski_duration_unit ]]</td>
                                                        <td class="text-center">[[ item.ski_cost_real_formatted ]]</td>

                                                        <td class="text-center">[[ item.ski_total_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_performance_formatted ]]</td>
                                                    </tr>
                                                </template>
                                                <tr class="header-row">
                                                    <td class="text-center">NO</td>
                                                    <td class="text-left" colspan="13">II. TUGAS TAMBAHAN DAN KREATIVITAS</td>
                                                </tr>
                                                <template is="dom-repeat" items="[[ report.extra ]]">
                                                    <tr>
                                                        <td class="text-center">[[ __computeSequence(index) ]]</td>
                                                        <td colspan="11">[[ item.ski_desc ]]</td>
                                                        <td class="text-center">[[ item.ski_total_formatted ]]</td>
                                                        <td class="text-center">[[ item.ski_performance_formatted ]]</td>
                                                    </tr>
                                                </template>
                                                <tr class="header-row">
                                                    <td colspan="13">&nbsp;</td>
                                                    <td>&nbsp;</td>
                                                </tr>
                                                <tr class="header-row">
                                                    <td class="text-middle text-center" colspan="13" rowspan="2">NILAI CAPAIAN SKP</td>
                                                    <td class="text-center">[[ report.skp_performance_formatted ]]</td>
                                                </tr>
                                                <tr class="header-row">
                                                    <td class="text-center">[[ report.skp_criteria_text ]]</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="page">
                                        <table class="table report-header">
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">
                                                        <h3>
                                                           BUKU CATATAN PENILAIAN PERILAKU PNS
                                                        </h3>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <table class="table">
                                            <tbody>
                                                <tr>
                                                    <td style="width: 150px;">Nama Pegawai</td>
                                                    <td style="width: 10px;">:</td>
                                                    <td><strong>[[ report.skp_su_fullname ]]</strong></td>
                                                </tr>
                                                <tr>
                                                    <td>NIP</td>
                                                    <td>:</td>
                                                    <td>[[ report.skp_su_no ]]</td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <table class="table bordered complex">
                                            <thead>
                                                <tr>
                                                    <th style="width: 30px;">NO</th>
                                                    <th>TANGGAL</th>
                                                    <th>URAIAN</th>
                                                    <th>NAMA/NIP &amp; PARAF PENILAI</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">1</td>
                                                    <td class="text-center">[[ report.skp_period ]]</td>
                                                    <td>
                                                        <div class="m-b">
                                                        Penilain SKP sampai akhir [[ report.skp_period_end ]] = <strong>[[ report.skp_performance_formatted ]]</strong><br>
                                                        sedangkan penilaian perilaku kerjanya adalah:
                                                        </div>
                                                        <table class="table noborder">
                                                            <tbody>
                                                                <template is="dom-repeat" items="[[ report.behaviors ]]">
                                                                    <tr>
                                                                        <td>[[ item.tsb_tbh_name ]]</td>
                                                                        <td>=</td>
                                                                        <td class="text-right">[[ item.tsb_value_formatted ]]</td>
                                                                        <td>&nbsp;</td>
                                                                        <td>[[ item.tsb_criteria_text ]]</td>
                                                                    </tr>
                                                                </template>
                                                                <tr style="border-top: 1px solid #d0d0d0;">
                                                                    <td>Jumlah</td>
                                                                    <td>=</td>
                                                                    <td class="text-right">[[ report.skp_behavior_total_formatted ]]</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Nilai Rata-rata</td>
                                                                    <td>=</td>
                                                                    <td class="text-right"><strong>[[ report.skp_behavior_average_formatted ]]</strong></td>
                                                                    <td>&nbsp;</td>
                                                                    <td>[[ report.skp_behavior_criteria_text ]]</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                    <td class="text-center">
                                                        <div>[[ report.evaluator_su_sj_name ]]</div>
                                                        <div style="height: 50px;"></div>
                                                        <div>[[ report.evaluator_su_fullname ]]</div>
                                                        <div>[[ report.evaluator_su_no ]]</div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                    </div>
                                    <div class="page">
                                        <table class="table report-header">
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">
                                                        <div class="logo-garuda"></div>
                                                        <h3>
                                                            PENILAIAN PRESTASI KERJA<br>
                                                            [[ report.skp_cover_header_2 ]]
                                                        </h3>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <table class="table">
                                            <tbody>
                                                <tr>
                                                    <td class="text-u-c text-middle"><strong>[[ report.company_scp_name ]]</strong></td>
                                                    <td class="text-u-c text-right">
                                                        <strong>
                                                        Jangka Waktu Penilaian<br>
                                                        [[ report.skp_period ]]
                                                        </strong>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <table class="table bordered complex">
                                            <tbody>
                                                <template is="dom-repeat" items="[[ actors ]]" as="actor">
                                                    <tr style="border-top: 1px solid #d0d0d0;">
                                                        <td rowspan="6" style="width: 30px;" class="text-center">[[ __computeSequence(index) ]].</td>
                                                        <td colspan="7">[[ actor.label ]]</td>
                                                    </tr>
                                                    <template is="dom-repeat" items="[[ actor.props ]]">
                                                        <tr>
                                                            <td style="width: 20px;">[[ __computeSequence(index, 'letter') ]].</td>
                                                            <td style="width: 250px; border-left: none;">[[ item.label ]]</td>
                                                            <td style$="[[ item.style ]]" colspan="4">[[ item.value ]]</td>
                                                        </tr>
                                                    </template>
                                                </template>
                                                
                                                <tr>
                                                    <td rowspan="6" class="text-center">4.</td>
                                                    <td colspan="5">UNSUR YANG DINILAI</td>
                                                    <td style="width: 100px;" class="text-center">JUMLAH</td>
                                                </tr>
                                                <tr>
                                                    <td>a.</td>
                                                    <td colspan="2" style="border-left: none;">Sasaran Kerja Pegawai (SKP)</td>
                                                    <td style="width: 80px;" class="text-center">[[ report.skp_performance_formatted ]]</td>
                                                    <td style="width: 80px;" class="text-center">X [[ report.skp_performance_portion ]] %</td>
                                                    <td class="text-center">[[ report.skp_performance_value_formatted ]]</td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="4" class="text-middle">b.</td>
                                                    <td rowspan="4" class="text-middle"  style="border-left: none;">Perilaku Kerja</td>
                                                    <td colspan="3" style="padding: 0;">
                                                        <table class="table bordered" style="margin-bottom: 0;">
                                                            <tbody>
                                                                <template is="dom-repeat" items="[[ report.behaviors ]]">
                                                                    <tr>
                                                                        <td style="width: 20px;">[[ __computeSequence(index) ]].</td>
                                                                        <td style="border-left: none;">[[ item.tsb_tbh_name ]]</td>
                                                                        <td class="text-center" style="width: 80px;">[[ item.tsb_value_formatted ]]</td>
                                                                        <td class="text-center" style="width: 80px;">[[ item.tsb_criteria_text ]]</td>
                                                                    </tr>
                                                                </template>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                    <td rowspan="3">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td>Jumlah</td>
                                                    <td class="text-center">[[ report.skp_behavior_total_formatted ]]</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>Nilai Rata-rata</td>
                                                    <td class="text-center">[[ report.skp_behavior_average_formatted ]]</td>
                                                    <td class="text-center">[[ report.skp_behavior_criteria_text ]]</td>
                                                </tr>
                                                <tr>
                                                    <td>Nilai Perilaku Kerja</td>
                                                    <td class="text-center">[[ report.skp_behavior_average_formatted ]]</td>
                                                    <td class="text-center">X [[ report.skp_behavior_portion ]] %</td>
                                                    <td class="text-center">[[ report.skp_behavior_value_formatted ]]</td>
                                                </tr>

                                                <tr>
                                                    <td colspan="6" class="text-center text-middle" rowspan="2">Nilai Prestasi Kerja</td>
                                                    <td class="text-center">[[ report.skp_value_formatted ]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">[[ report.skp_criteria_text ]]</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-center">5.</td>
                                                    <td colspan="6">
                                                        <div class="m-b">KEBERATAN DARI PEGAWAI NEGERI SIPIL YANG DINILAI</div>
                                                        <div class="m-b">[[ report.skp_objection ]]</div>
                                                        <div class="text-right">Tanggal [[ report.skp_objection_dt_formatted ]]</div>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="text-center">6.</td>
                                                    <td colspan="6">
                                                        <div class="m-b">TANGGAPAN PEJABAT PENILAI ATAS KEBERATAN</div>
                                                        <div class="m-b">[[ report.skp_response ]]</div>
                                                        <div class="text-right">Tanggal [[ report.skp_response_dt_formatted ]]</div>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="text-center">7.</td>
                                                    <td colspan="6">
                                                        <div class="m-b">PUTUSAN ATASAN PEJABAT PENILAI ATAS KEBERATAN</div>
                                                        <div class="m-b">[[ report.skp_resolution ]]</div>
                                                        <div class="text-right">Tanggal [[ report.skp_resolution_dt_formatted ]]</div>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="text-center">8.</td>
                                                    <td colspan="6">
                                                        <div class="m-b">REKOMENDASI</div>
                                                        <div class="m-b">[[ report.skp_recommendation ]]</div>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td></td>
                                                    <td colspan="2"></td>
                                                    <td style="border-left: none;"></td>
                                                    <td style="border-left: none;" colspan="3">
                                                        <div class="text-center text-u-c">9. DIBUAT TANGGAL, [[ report.skp_report_dt_formatted ]]</div>
                                                        <div class="text-center">PEJABAT PENILAI</div>
                                                        <div style="height: 50px;"></div>
                                                        <div class="text-center">[[ report.evaluator_su_fullname ]]</div>
                                                        <div class="text-center">[[ report.evaluator_su_no ]]</div>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="text-center">10.</td>
                                                    <td colspan="2">
                                                        <div class="text-center text-u-c">DITERIMA TANGGAL, [[ report.skp_receive_dt_formatted ]]</div>
                                                        <div class="text-center">PEGAWAI NEGERI SIPIL<br>YANG DINILAI</div>
                                                        <div style="height: 50px;"></div>
                                                        <div class="text-center">[[ report.skp_su_fullname ]]</div>
                                                        <div class="text-center">[[ report.skp_su_no ]]</div>
                                                    </td>
                                                    <td style="border-left: none;" ></td>
                                                    <td  style="border-left: none;" colspan="3"></td>
                                                </tr>

                                                <tr>
                                                    <td></td>
                                                    <td colspan="2"></td>
                                                    <td style="border-left: none;"></td>
                                                    <td style="border-left: none;" colspan="3">
                                                        <div class="text-center text-u-c">11. DITERIMA TANGGAL, [[ report.skp_disposition_dt_formatted ]]</div>
                                                        <div class="text-center">ATASAN PEJABAT YANG MENILAI</div>
                                                        <div style="height: 50px;"></div>
                                                        <div class="text-center">[[ report.examiner_su_fullname ]]</div>
                                                        <div class="text-center">[[ report.examiner_su_no ]]</div>
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </iron-pages>
                                
                            </div>
                            <div class="tabs">
                                <paper-tabs selected="{{ sheetIndex }}" no-bar scrollable align-bottom>
                                    <template is="dom-repeat" items="[[ sheets ]]">
                                        <paper-tab>
                                            <div class="overlay" style$="background-color: [[ item.accent ]]"></div>
                                            <span class="caption">[[ item.label ]]</span>
                                        </paper-tab>
                                    </template>
                                </paper-tabs>
                            </div>
                        </kct-vbox>

                    </div>
                </app-drawer-layout>
            </div>

        </kct-vbox>

    </template>
    <script>
        class SkpReport extends Mixins(KctView).use(Mixins.SkpPageBehavior) {
            static get is() {
                return 'skp-report';
            }
            static get properties() {
                return {
                    params: { type: Object, value: () => ({}) },
                    sheets: { 
                        type: Array, 
                        value: () => ([
                            { label: 'DATA SKP', accent: 'var(--paper-blue-500)' },
                            { label: 'COVER', accent: 'var(--paper-pink-500)' },
                            { label: 'FORM SKP', accent: 'var(--paper-purple-500)' },
                            { label: 'PENGUKURAN', accent: 'var(--paper-indigo-500)' },
                            { label: 'PERILAKU', accent: 'var(--paper-amber-500)' },
                            { label: 'PENILAIAN', accent: 'var(--paper-blue-grey-500)' }
                        ]) 
                    },
                    sheetIndex: { type: Number, value: 5 },
                    actors: { type: Array, value: () => ([]) },
                    report: { type: Object, value: () => ({}) },
                    loading: { type: Boolean, value: false }
                };
            }
            static get observers() {
                return [
                    '__sheetIndexChanged(sheetIndex)'
                ];
            }
            handleRouteParams(page) {
                if (page != 'report') return;
                this.__initializeParams();
            }

            __initializeParams() {
                this.set('loading', true);

                this.$.ajax.GET('/skp/observable-users', {
                    params: {
                        su_id: this.user.su_id
                    }
                }).then(res => {

                    if (res.success) {
                        let users = (res.data || []);
                        if (users.length) {
                            this.set('params.user', users[0].su_id);

                            this.$.ajax.GET('/skp', {
                                params: {
                                    skp_su_id: users[0].su_id
                                },
                                sort: [
                                    { property: 'skp_start_date', direction: 'desc' }
                                ]
                            }).then(res => {
                                
                                if (res.success) {
                                    let docs = (res.data || []);
                                    if (docs.length) {
                                        this.set('params.skp', docs[0].skp_id);
                                        this.__loadReport();
                                    }
                                } else {
                                    this.set('loading', false);
                                }
                            });
                        } else {
                            this.set('loading', false);
                        }
                    } else {
                        this.set('loading', false);
                    }
                });
            }

            __computeSequence(index, type) {
                if (type == 'letter') {
                    return String.fromCharCode((97 + index));
                } else {
                    return index + 1;    
                }
            }

            __sheetIndexChanged(index) {
                if (index !== -1) {
                    let sheetRecord = this.get('sheets.' + index);
                    this.updateStyles({
                        '--tabs-border-color': sheetRecord.accent
                    });
                }
            }

            __reload() {
                this.__loadReport();
            }

            __loadReport() {
                if ( ! this.params.skp) {
                    return;
                }

                this.set('loading', true);

                this.$.ajax.GET('/skp/' + this.params.skp + '?display=report').then(res => {
                    this.set('loading', false);
                    if (res.success) {
                        let report = res.data || {};
                        this.set('report', report);
                        this.__computeActors();
                    }
                });
            }

            __computeActors() {
                let report = (this.report || {});

                let actors = [
                    { label: 'YANG DINILAI', props: [] },
                    { label: 'PEJABAT PENILAI', props: [] },
                    { label: 'ATASAN PEJABAT PENILAI', props: [] }
                ];

                // parse authors
                let props = {
                    'su_fullname': 'Nama',
                    'su_no': 'NIP',
                    'su_sg_name': 'Pangkat/Gol.Ruang',
                    'su_sj_name': 'Jabatan',
                    'su_sdp_name': 'Unit Kerja'
                };

                Object.keys(report).forEach(k => {
                    let name, prop, style;
                    let i = 0;

                    style = '';

                    for(name in props) {
                        prop = 'skp_' + name;

                        if (i == 0) {
                            style  = '';
                        }

                        style += 'font-weight: bold';

                        if (k == prop) {
                            actors[0].props.push({
                                label: props[name],
                                value: report[prop],
                                style: style
                            })
                        }
                        prop = 'evaluator_' + name;
                        if (k == prop) {
                            actors[1].props.push({
                                label: props[name],
                                value: report[prop],
                                style: style
                            });
                        }
                        prop = 'examiner_' + name;
                        if (k == prop) {
                            actors[2].props.push({
                                label: props[name],
                                value: report[prop],
                                style: style
                            })
                        }
                        i++;
                    }
                });

                this.set('actors', actors);
            }

            __onComboUserChange() {
                this.$['combo-skp'].value = '';
                this.$['combo-skp'].load();
            }

            __onComboSkpBeforeload(e) {
                let user = this.params.user || -1;
                e.detail.options.params = {
                    skp_su_id: user
                };
            }

            __onQueryTap() {
                this.__toggleDrawer();
                this.__reload();
            }

            __onReloadTap() {
                this.__reload();
            }

            __onPrintTap() {
                if (this.params.skp) {
                    this.$.ajax.DOWNLOAD('/skp/print/document/xls/' + this.params.skp);
                }
            }
        }
        customElements.define(SkpReport.is, SkpReport);
    </script>
</dom-module>