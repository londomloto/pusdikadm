<link rel="import" href="../../../shared/project-task-prop.html">

<dom-module id="absensi-task-prop">
    <template>
        <style include="project-task-prop-style"></style>

        <kct-ajax id="ajax"></kct-ajax>
        <kct-socket manager="global-socket" session="{{ socketSession }}"></kct-socket>

        <div class="scroller">

            <div class="form-group">
                <div class="label">Status Dokumen</div>
                <div class="field">
                    <div class="display">
                        <div class="empty" hidden$="[[ __hideEmptyStatus(record.status.status_text) ]]">Belum ada</div>
                        <div class="value" hidden$="[[ !__hideEmptyStatus(record.status.status_text) ]]">
                            <iron-icon icon="bookmark-border" class="value-icon"></iron-icon>    
                            <span class="value-text">[[ record.status.status_text ]]</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="label">Pembuat Dokumen</div>
                <div class="field">
                    <div class="display">
                        <div class="user-item">
                            <div class="icon">
                                <img src$="[[ record.task.creator_su_avatar_thumb ]]&w=40&h=40"> 
                            </div>
                            <div class="text">
                                <div>[[ record.task.creator_su_fullname ]]</div>
                                <div class="meta">[[ record.task.creator_sr_name ]]</div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="tools">
                    <save-indicator id="due-indicator"></save-indicator>
                    <paper-button on-tap="__onDueEditTap"><iron-icon icon="image:edit"></iron-icon>&nbsp;Edit</paper-button>
                </div>
                <div class="label">Target Penyelesaian</div>
                <div class="field">
                    <div class="editor" hidden$="[[ !__states.editing.due ]]">
                        <task-date-picker
                            id="due-picker" 
                            on-value-changed="__onDuePickerChange"></task-date-picker>
                    </div>
                    <div class="display">
                        <div class="empty" hidden$="[[ __hideEmptyDue(record.task.tpr_task_due) ]]">Belum ada</div>
                        <div class="value" hidden$="[[ !__hideEmptyDue(record.task.tpr_task_due) ]]">
                            <iron-icon icon="today" class="value-icon"></iron-icon>    
                            <span class="value-text">[[ record.task.tpr_task_due_formatted ]]</span> - <a on-tap="__onDueRemoveTap" href="javascript:;">Hapus</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="tools">
                    <save-indicator id="label-indicator"></save-indicator>
                    <paper-button on-tap="__onLabelEditTap"><iron-icon icon="image:edit"></iron-icon>&nbsp;Edit</paper-button>
                </div>
                <div class="label">Label</div>
                <div class="field">
                    <div class="editor" hidden$="[[ !__states.editing.label ]]">
                        <task-combo-label 
                            id="combo-label" 
                            project="[[ project ]]" 
                            on-change="__onComboLabelChange" 
                            on-action="__onComboLabelAction" 
                            on-label-add="__onComboLabelAdd"></task-combo-label> 
                    </div>
                    <div class="display">
                        <div class="empty" hidden$="[[ __hideEmptyLabel(record.labels.splices) ]]">Belum ada</div>
                        <template is="dom-repeat" items="[[ record.labels ]]">
                            <div class="label-item" style$="background-color: [[ item.sl_color ]]">
                                <span>[[ item.sl_label ]]</span>
                                <paper-icon-button on-tap="__onLabelRemoveTap" icon="close"></paper-icon-button>
                            </div>
                        </template>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>

        </div>
    </template>
    <script>
        class AbsensiTaskProp extends Mixins(Polymer.Element).use(Mixins.ProjectTaskProp) {

            static get is() {
                return 'absensi-task-prop';
            }

            initialize() {
                let today = moment();

                this.set('record.task.tpr_task_due', today.format('YYYY-MM-DD'));
                this.set('record.task.tpr_task_due_formatted', today.format('DD MMM YYYY'));
                this.set('record.task.creator_su_fullname', this.user.su_fullname);
                this.set('record.task.creator_su_avatar_thumb', this.user.su_avatar_thumb);
                this.set('record.task.creator_sr_name', this.user.sr_name);

                this.set('record.status.status_text', 'Draft Absensi');
            }
        }

        customElements.define(AbsensiTaskProp.is, AbsensiTaskProp);
    </script>
</dom-module>